<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">






 
 


 

  
  
  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/apis/maps/articles/android_v3.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Loading a Maps API site in a Native Android Application - Google Maps API Family - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/apis/maps/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../../css/iehacks.css"><![endif]-->

    <link href="../../../css/semantic_headers.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="gc-documentation">

    
    
    <div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  <a href="#gc-pagecontent">Skip to page content</a>
  <a href="#gc-toc">Skip to main navigation</a>
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
  
     <img src="../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "adwords" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Maps API Family</h1>
  <ul id="articles" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="../index.html" title="Google Maps API Family home page">Home</a>
    </li>
  
    <li id="faq_link">
      <a href="../faq.html" title="Answers to frequently asked questions about Google Maps API Family">FAQ</a>
    </li>
  
    <li id="articles_link">
      <a href="index.html" class="selected" title="Focused articles and tutorials for Google Maps API Family developers">Articles</a>
    </li>
  
    <li>
      <a href="http://googlegeodevelopers.blogspot.com/" title="Official Google Maps API Family blog">Blog</a>
    </li>
  
    <li>
      <a href="../forum/index.html" title="Google Maps API Family developer forum">Forum</a>
    </li>
  
    <li>
      <a href="../terms.html" title="Google Maps API Family terms of service">Terms</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->

    <div class="g-section g-tpl-170">

      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li><a href="../index.html">Maps API Family</a></li>
  <li><a href="http://code.google.com/apis/kml/documentation/kmlSearch.html">Index Your Maps Content</a></li>
</ul>
      <div class="line"></div>
      <ul>
        <li><h2>Maps Javascript API V3</h2>
         <ul>
           <li><a href="../documentation/javascript/index.html">Home Page</a></li>
           <li><a href="../documentation/javascript/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
      <ul>
        <li><h2>Maps Javascript API V2</h2>
         <p><span style="color:grey">(Deprecated API)</span></p>
         <ul>
           <li><a href="../documentation/javascript/v2/index.html">Home Page</a></li>
           <li><a href="../documentation/javascript/v2/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
  <div class="line"></div>
    <ul>
      <li><h2>Maps API for Flash</h2>
        <ul>
          <li><a href="../documentation/flash/index.html">Home Page</a></li>
          <li><a href="../documentation/flash/intro.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
    <div class="line"></div>
    <ul>
      <li><h2>Maps Data API</h2>
        <p><span style="color:grey">(Deprecated API)</span></p>
        <ul>
          <li><a href="../documentation/mapsdata/index.html">Home Page</a></li>
          <li><a href="../documentation/mapsdata/developers_guide_protocol.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
     <div class="line"></div>
      <ul>
        <li><h2><a href="../documentation/webservices/index.html">Maps Web Services</a></h2>
         <ul>
           <li><a href="../documentation/geocoding/index.html">Geocoding Guide</a></li>
           <li><a href="../documentation/directions/index.html">Directions Guide</a></li>
           <li><a href="../documentation/elevation/index.html">Elevation Guide</a></li>
           <li><a href="../documentation/places/index.html">Places Guide</a></li>
         </ul>
       </li>
      </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Static Maps API</h2>
            <ul>
              <li><a href="../documentation/staticmaps/index.html">Developer Guide</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Earth API</h2>
            <ul>
              <li><a href="http://code.google.com/apis/earth">Home Page</a></li>
              <li><a href="http://code.google.com/apis/earth/documentation">Documentation</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li>
            <h2>Local Search API</h2>
            <p><span style="color:grey">(Deprecated API)</span></p>
            <ul>
              <li>
                <a href="../documentation/localsearch/index.html">Home Page</a>
              </li>
              <li>
                <a href="../documentation/localsearch/start.html">Documentation</a>
              </li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
      <div class="promo">
     <p><a href="../documentation/premier/index.html">Google Maps API Premier</a></p><p>Includes enterprise licensing and support</p></div>

        <a class="hidden" href="#gc-topnav-anchor">More Google Maps API Family resource links</a>
      </div>
      <div class="g-unit" id="gc-pagecontent">
        <h1 class="page_title">Loading a Maps API site in a Native Android Application</h1>


<!-- ########## PAGE CONTENT ########## -->
<div class=i>
<i>Mano Marks, Google Geo APIs Team</i>
<br>
<em>December 2009</em>

<br/>
<h2>Contents</h2>
<ol>
<li><a href="#objective">Objective</a></li>
<li><a href="#why">Why Load a V3 Page into a Native App?</a></li>
<li><a href="#how">How it all works</a></li>
<li><a href="#layout">Layout</a></li>
<li><a href="#manifest">Managing Permissions</a></li>
<li><a href="#code">Writing the code</a></li>
<li><a href="#map">The Map</a></li>
<li><a href="#nextsteps">Next Steps</a></li>
</ol>
<a name="objective"></a>
<h1>Objective</h1>
<p class="para">This tutorial is intended for Java developers who are 
familiar withi Android development.
 The code within this tutorial will use version 1.1
 of the Android SDK and the <a href="../documentation/javascript/index.html" 
target="_blank">Google Maps API Version 3</a>.</p><p>After completing this tutorial, 
you will have an application that loads a Google Map and centers it at the location
 provided by the Android device. To view the complete code for this article,see
the <a href="http://gmaps-samples.googlecode.com/svn/trunk/articles-android-webmap/"
 target="_blank">gmaps-samples</a> project on Google Code Hosting.</p>
<p class="para">This tutorial is not meant as a complete introduction to Android development. For more information on getting started with Android, check out <a href="http://developer.android.com/" target="_blank">the Android Developers guide</a>.
</p>
<a name="why"></a>
<h1>Why load a V3 page into a native app?</h1>
<p class="para">The Android development environment provides a lot of advantages to developers, including:</p>
<ul>
<li>Access to native services on the device, including location services</li>
<li>Placement in the Android Market</li>
<li>Rapid development using the Android SDK and Eclipse</li>
</ul>
<p class="para">Note that a native <a 
href="http://code.google.com/android/add-ons/google-apis/maps-overview.html" 
target="_blank">Android Google Maps API</a> exists. Some developers, naturally  
will want to develop solely within that environment. However, these are some 
significant advantages to developing a Google Maps API page that lives on a 
server, not within the application.</p>
<ul>
<li>Rapid versioning: With a map application on your server, you can modify it quickly without launching an update in the Android Market. This removes the requirement for your users to download and install an update merely to get a new version of the map. Instead, they can get a new one any time they open your app.</li>
<li>More frequent feature additions and bug fixes from Google: Instead of waiting for the next Android update, the Google Maps API can update on the server, without having to update on every device using your application.</li>
<li>Cross-platform compatibility: Using the Maps API allows you to create a single map that runs on multiple platforms.</li>
</ul>
<a name="how"></a>
<h1>How it Works</h1>
<p class="para">Loading a web page into an Android application is done using
 a <b><code>WebView</code></b>. The <b><code>WebView</code></b> essentially 
embeds a browser into your app. The browser exposes controls to allow you to shape how
 you're loading the page. This embedded browser also allows you to expose a JavaScript to Java bridge,
 which gives you the capability to call Java methods in your native Android 
application from the JavaScript page. This <b><code>WebView</code></b> also allows you to make JavaScript calls
 directly from your Java application as well.</p>
<p class="para">Once you've created a new empty Android Application, there are four
 essential components you have to modify or create to build your 
<b><code>WebView</code></b>.</p>
<ol><li>Your layout. In this application, this is in the <code>res/layout/main.xml</code> 
file</li>
<li>The Android manifest file whcih helps you manage your permissions to use the

Internet and the location services on the device.</li>
<li>A Java class to create and manage the <b><code>WebView</code></b><code>activity.</code></li>
<li>The map your application will load.</li>
</ol>
<p class="para">Each of these components are described in the following sections.</p>

<a name="layout"></a>
<h1>Layout</h1>
<p class="para">The layout file defines the components of your user interface. You need to add a <b><code>WebView</code></b> to create the element that will load your page. Add this element to your <code>LinearLayout</code>:</p>
<pre class="prettyprint lang-xml">
<?xml version="1.0" encoding="utf-8"?>
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"&gt;
  &lt;WebView android:id="@+id/webview"
      android:layout_width="fill_parent"
      android:layout_height="fill_parent"/&gt;
&lt;/LinearLayout&gt;
</pre>
<p class="para">Adds a WebView element that fills the screen. Note the <b><code>
WebView</code></b> element has an attribute <code>android:id="@+id/webview"</code>.
 This allows the application to identify the <b><code>WebView</code></b> by 
the id <code>webview</code>.</p>
<a name="manifest"></a>
<h1>Managing Permissions</h1>
<p class="para">To access some of the services on an Android device, such as 
the Internet and position information, the application must ask for permission.
 This request for permission is done through the <code>AndroidManifest.xml</code>
 file that every application must have. When the user installs the application,
 the device will ask the user to approve the request. If the user does not 
approve it, the application will not get installed. If they do, the application
 will install and have access to the services it needs.</p>
<p class="para">To grant the application access to the Internet and to location
 services, add these three lines to the <code>AndroidManifest.xml</code> file:</p>
<pre class="prettyprint lang-xml">
&lt;uses-permission android:name="android.permission.INTERNET"/&gt;
&lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
</pre>
<p class="para">The first line gives access to the Internet, allowing your application to use Internet resources. The second line gives access to the approximate location of your device. This will come from different sources depending on your device, but will generally come from approximating your location using WiFi or CellId lookup. The third line gives access to your more precise location, usually from GPS in the device.</p>
<a name="code"></a>
<h1>Writing the Code</h1>
<p class="para">To load your map into your app, create your <b><code>WebView
</code></b>, enable it to use JavaScript, and then load the URL to your page. 
If you want to use location information, expose through a JavaScript interface.
 This sample code uses a <b><code>WebMapActivity</code></b> class, which extends <code><a href="http://developer.android.com/reference/android/app/Activity.html"
 target="_blank">Activity</a></code>. An <code>Activity</code> is the basic 
interface for creating a visual interaction in an Android application. </p>
<pre class="prettyprint lang-java">
public class WebMapActivity extends Activity {
  private static final String MAP_URL = "http://gmaps-samples.googlecode.com/svn/trunk/articles-android-webmap/simple-android-map.html";
  private WebView webView;
  @Override
  /** Called when the activity is first created. */
  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);
    getLocation();
    setupWebView();
    this.setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);
  }
  /** Sets up the WebView object and loads the URL of the page **/
  private void setupWebView(){
    final String centerURL = "javascript:centerAt(" +
    mostRecentLocation.getLatitude() + "," +
    mostRecentLocation.getLongitude()+ ")";
    webView = (WebView) findViewById(R.id.webview);
    webView.getSettings().setJavaScriptEnabled(true);
    //Wait for the page to load then send the location information
    webView.setWebViewClient(new WebViewClient());
    webView.loadUrl(MAP_URL);
  }</pre>
<p class="para">To enable location tracking, you have to take a few steps. 
First, you have to get the location from the device. <b><code>WebMapActivity
</code></b> uses a <b><code>LocationManager</code></b> to get the location. 
<b><code>LocationManager</code></b> requires a listener. In this sample, 
<b><code>WebMapActivity</code></b> implements <b><code>LocationListener</code></b> and
 acts as a listener for the <b><code>LocationManager</code></b>.</p>
<pre class="prettyprint lang-java">
public class WebMapActivity extends Activity implements LocationListener {
  private static final String MAP_URL = "http://gmaps-samples.googlecode.com/svn/trunk/articles-android-webmap/simple-android-map.html";
  private void getLocation() {
    LocationManager locationManager =
      (LocationManager)getSystemService(Context.LOCATION_SERVICE);
    Criteria criteria = new Criteria();
    criteria.setAccuracy(Criteria.ACCURACY_FINE);
    String provider = locationManager.getBestProvider(criteria,true);
    //In order to make sure the device is getting the location, request updates.
    locationManager.requestLocationUpdates(provider, 1, 0, this);
    mostRecentLocation = locationManager.getLastKnownLocation(provider);
  }
</pre>
<p class="para">This creates a <code>Location</code> object that can be queried for the last location known to the device. Then you have two
choices.</p>
<ul><li>Have your application call JavaScript functions in the page directly, 
passing location information to the JavaScript through a direct JavaScript call.</li>
<li>Your app can expose a JavaScript interface to the <b><code>Location</code></b> object.</li>
</ul>
<p class="para" In the following sample, the application calls <code>centerAt</code>,
 which centers the map on the location provided by the device:
</p>
<pre class="prettyprint lang-java">
private void setupWebView(){
  final String centerURL = "javascript:centerAt(" +
  mostRecentLocation.getLatitude() + "," +
  mostRecentLocation.getLongitude()+ ")";
  webView = (WebView) findViewById(R.id.webview);
  webView.getSettings().setJavaScriptEnabled(true);
  //Wait for the page to load then send the location information
  webView.setWebViewClient(new WebViewClient(){
    @Override
    public void onPageFinished(WebView view, String url){
      webView.loadUrl(centerURL);
    }
  });
  webView.loadUrl(MAP_URL);
}
</pre>
<p class="para">The following example exposes an interface, 
<code>window.android</code>, which can be accessed directly through JavaScript 
calls in the page. This interface is a powerful way to expose internal Android 
services to the page. The disadvantage is that it is less universal, only 
available when loading the page on an Android device. If you're going to develop
 this way, the best thing to do is test for <code>window.android</code> and 
have a fallback in case those services are not available.</p>
<pre class="prettyprint lang-java">
private void setupWebView(){
  final String centerURL = "javascript:centerAt(" +
  mostRecentLocation.getLatitude() + "," +
  mostRecentLocation.getLongitude()+ ")";
  webView = (WebView) findViewById(R.id.webview);
  webView.getSettings().setJavaScriptEnabled(true);
  //Wait for the page to load then send the location information
  webView.setWebViewClient(new WebViewClient());
  webView.loadUrl(MAP_URL);
  /** Allows JavaScript calls to access application resources **/
  webView.addJavascriptInterface(new JavaScriptInterface(), "android");
}
/** Sets up the interface for getting access to Latitude and Longitude data from device
 **/
private class JavaScriptInterface {
  public double getLatitude(){
    return mostRecentLocation.getLatitude();
  }
  public double getLongitude(){
    return mostRecentLocation.getLongitude();
  }
}
</pre>
<a name="map"></a>
<h1>The Map</h1>
<p class="para">Then just create the map as you would normally. This example 
code tests if <code>window.android</code> - or whatever you've named your 
JavaScript bridge - exists, and if not sets the center to 0,0. This example 
also exposes the <code>centerAt</code> function which allows the Android app to 
set the center through JavaScript:</p>
<pre class="prettyprint lang-js">
&lt;script type="text/javascript" 
  src="http://maps.google.com/maps/api/js?sensor=true"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
  var map;
  function initialize() {
    var latitude = 0;
    var longitude = 0;
    if (window.android){
      latitude = window.android.getLatitude();
      longitude = window.android.getLongitude();
    }
    var myLatlng = new google.maps.LatLng(latitude,longitude);
    var myOptions = {
      zoom: 8,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    map = new google.maps.Map(document.getElementById("map_canvas"),
      myOptions);
  }
  function centerAt(latitude, longitude){
    myLatlng = new google.maps.LatLng(latitude,longitude);
    map.panTo(myLatlng);
  }
&lt;/script&gt;
</pre>
<br/>
<p class="para">Once loaded on the phone, the map will look something like this:</p>
<br/>
<img src="http://gmaps-samples.googlecode.com/svn/trunk/articles-android-webmap/images/webmapactivity.png" style="border: 1px solid grey; margin-left: 2em;" alt="Screenshot of map on phone">
<a name="nextsteps"></a>
<h1>Next Steps</h1>
<p class="para">Now that you've created a basic application, you can take advantage of other services provided by the Android platform. For instance, you could:</p>
<ul><li>Allow the user to store locations or preferences on their device.</li>
<li>Map out where their contacts live.</li>
<li>Allow the user to move the map using the accelerometer and compass.</li>
</ul>
<p class="para">And of course, once you've developed your Android app, publish it to the <a href="http://www.android.com/market/" target="_blank">Android Market.</a></p>
<!-- ########## END PAGE CONTENT ########## -->
  
   
      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
    &copy;2010 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>



