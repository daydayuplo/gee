<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">







 
 


 

  
  
  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/apis/maps/articles/flashmapinwpf.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Hosting Google Maps in a Microsoft WPF application using XAML - Google Maps API Family - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/apis/maps/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../../css/iehacks.css"><![endif]-->

    <link href="../../../css/semantic_headers.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="gc-documentation">

    
    
    <div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  <a href="#gc-pagecontent">Skip to page content</a>
  <a href="#gc-toc">Skip to main navigation</a>
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
  
     <img src="../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "adwords" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Maps API Family</h1>
  <ul id="articles" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="../index.html" title="Google Maps API Family home page">Home</a>
    </li>
  
    <li id="faq_link">
      <a href="../faq.html" title="Answers to frequently asked questions about Google Maps API Family">FAQ</a>
    </li>
  
    <li id="articles_link">
      <a href="index.html" class="selected" title="Focused articles and tutorials for Google Maps API Family developers">Articles</a>
    </li>
  
    <li>
      <a href="http://googlegeodevelopers.blogspot.com/" title="Official Google Maps API Family blog">Blog</a>
    </li>
  
    <li>
      <a href="../forum/index.html" title="Google Maps API Family developer forum">Forum</a>
    </li>
  
    <li>
      <a href="../terms.html" title="Google Maps API Family terms of service">Terms</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->

    <div class="g-section g-tpl-170">

      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li><a href="../index.html">Maps API Family</a></li>
  <li><a href="http://code.google.com/apis/kml/documentation/kmlSearch.html">Index Your Maps Content</a></li>
</ul>
      <div class="line"></div>
      <ul>
        <li><h2>Maps Javascript API V3</h2>
         <ul>
           <li><a href="../documentation/javascript/index.html">Home Page</a></li>
           <li><a href="../documentation/javascript/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
      <ul>
        <li><h2>Maps Javascript API V2</h2>
         <p><span style="color:grey">(Deprecated API)</span></p>
         <ul>
           <li><a href="../documentation/javascript/v2/index.html">Home Page</a></li>
           <li><a href="../documentation/javascript/v2/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
  <div class="line"></div>
    <ul>
      <li><h2>Maps API for Flash</h2>
        <ul>
          <li><a href="../documentation/flash/index.html">Home Page</a></li>
          <li><a href="../documentation/flash/intro.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
    <div class="line"></div>
    <ul>
      <li><h2>Maps Data API</h2>
        <p><span style="color:grey">(Deprecated API)</span></p>
        <ul>
          <li><a href="../documentation/mapsdata/index.html">Home Page</a></li>
          <li><a href="../documentation/mapsdata/developers_guide_protocol.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
     <div class="line"></div>
      <ul>
        <li><h2><a href="../documentation/webservices/index.html">Maps Web Services</a></h2>
         <ul>
           <li><a href="../documentation/geocoding/index.html">Geocoding Guide</a></li>
           <li><a href="../documentation/directions/index.html">Directions Guide</a></li>
           <li><a href="../documentation/elevation/index.html">Elevation Guide</a></li>
           <li><a href="../documentation/places/index.html">Places Guide</a></li>
         </ul>
       </li>
      </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Static Maps API</h2>
            <ul>
              <li><a href="../documentation/staticmaps/index.html">Developer Guide</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Earth API</h2>
            <ul>
              <li><a href="http://code.google.com/apis/earth">Home Page</a></li>
              <li><a href="http://code.google.com/apis/earth/documentation">Documentation</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li>
            <h2>Local Search API</h2>
            <p><span style="color:grey">(Deprecated API)</span></p>
            <ul>
              <li>
                <a href="../documentation/localsearch/index.html">Home Page</a>
              </li>
              <li>
                <a href="../documentation/localsearch/start.html">Documentation</a>
              </li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
      <div class="promo">
     <p><a href="../documentation/premier/index.html">Google Maps API Premier</a></p><p>Includes enterprise licensing and support</p></div>

        <a class="hidden" href="#gc-topnav-anchor">More Google Maps API Family resource links</a>
      </div>

      <div class="g-unit" id="gc-pagecontent">
        <h1 class="page_title">Hosting Google Maps in a Microsoft WPF application using XAML</h1>


<!-- ########## PAGE CONTENT ########## -->

<i>Marc Ridey, Google Geo Team</i>
<br/>
<i>March 2009</i>

<br/><br/>

<p>
With the Google Maps API for Flash, it is now very easy to add Google Maps
technology to your Microsoft Windows Presentation Foundation (WPF) application
using XAML.
</p>

<p>
The Google Maps API for Flash runs as a Flash application inside the Flash
player control. The Flash Player control is embedded in the WPF application and
code glue allows your Native .NET C# or VB.NET code to interface for the Google
Maps control in Flash.
</p>

<p>
This sample project demonstrates you how to insert Google Maps in your WPF
application, how to access the Google Maps API and interface with the Maps
control, and how to receive information back from the control in the WPF
application.
</p>

<p>
The final application looks like this:
</p>

<p>
<img width=600 height=437
     src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image001.jpg">
</p>

<p>
The address bar at the top is a WPF <code><b>TextBox</b></code> control. 
You can type any address, press Enter (or the Search button) and 
the map will display a marker at the requested address.
</p>

<p>
The values at the bottom of the screen are <code><b>TextBox</b></code>
controls that display the longitude and latitude of
the marker oberlay on the map. Clicking on the map will reposition the marker
and send an event from the Google Maps control in Flash to the WPF code.
</p>

<p>
So how is all this done?
</p>

<h3>
Prepare GoogleMaps.swf using the Adobe Flex SDK.
</h3>

<p>
You need to create a SWF File to display the Google map
control and interface with it. Detailed information with step by step
instructions on how to setup your Flex development environment is available at
 <a href="http://code.google.com/apis/maps/documentation/flash/tutorial-flex.html">http://code.google.com/apis/maps/documentation/flash/tutorial-flex.html</a>.
</p>

<ol>

<li>

Create an MXML file called "GoogleMaps.mxml" and add the following code:

<pre class="prettyprint">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute"&gt;
</pre>

<p>
This is the standard MXML header.
</p>

<pre class="prettyprint">
&lt;maps:Map xmlns:maps="com.google.maps.*"
  id="map"
  mapevent_mapready="onMapReady(event)"
  width="100%"
  height="100%"/&gt;
</pre>

<p>
The Google maps control is configured to use 100% of the
Flash player area as the rest of the user interface is provided in WPF. 
On receipt of the <code>mapevent_mapready</code> event, we
call the <code>onMapReady</code> function.
</p>

<pre class="prettyprint">
&lt;mx:Script&gt;
 &lt;![CDATA[
 import com.google.maps.services.ClientGeocoderOptions;
 import com.google.maps.overlays.Marker;
 import com.google.maps.controls.MapTypeControl;
 import com.google.maps.controls.PositionControl;
 import com.google.maps.controls.ZoomControl;
 import com.google.maps.InfoWindowOptions;
 import com.google.maps.MapMouseEvent;
 import com.google.maps.services.ClientGeocoder;
 import com.google.maps.services.GeocodingEvent;
 import com.google.maps.LatLng;
 import com.google.maps.Map;
 import com.google.maps.MapEvent;
 import com.google.maps.MapType;
 import mx.controls.Alert;

 private var marker : Marker;

 private function onMapReady(event:Event):void { ... }
 private function onMapClick(event:MapMouseEvent):void { ... }
 private function onSearch(address:String):void { ... }
 ]]&gt;
&lt;/mx:Script&gt;
</pre>

<p>
The script for this MXML application is inlined with the
MXML code but could be managed in a separate file. In addition to the import
definitions required to access the Google Maps API within Flash, there are
three private functions defined. These are discussed below.
</p>

<pre class="prettyprint">
&lt;/mx:Application&gt;
</pre>

<p>
And finally the closing tag for the MXML file.
</p>

<h4>
onMapReady function:
</h4>

<pre class="prettyprint">
private function onMapReady(event:Event):void
{
  var centerLL : LatLng = new LatLng(38.900218,-77.036562);
  map.setCenter( centerLL, 18, MapType.NORMAL_MAP_TYPE);

  map.addControl(new ZoomControl());
  map.addControl(new PositionControl());
  map.addControl(new MapTypeControl());

  map.addEventListener(MapMouseEvent.CLICK,onMapClick);

  marker = new Marker( centerLL );
  map.addOverlay( marker );

  ExternalInterface.addCallback("Search",onSearch);
}
</pre>

<p>
This function has five specific tasks:
</p>

<ul>
  <li>Centers the map to a pre-defined position using <code>map.setCenter()</code></li>
  <li>Adds the <code>Zoom</code>, <code>Position</code> and <code>MapType</code> controls to the map control using <code>map.addControl()</code></li>
  <li>
    Binds the <code>onMapClick</code> function to the <code>MapMouseEvent.Click</code> event to monitor mouse clicks on
    the map using <code>map.addEventListener()</code>
  </li>
  <li>Adds a marker on the map using <code>map.addOverlay()</code></li>
  <li>
    Binds the <code>onSearch</code> function to the <code>Search</code> event on the <code>ExternalInterface</code> (more on this later).
  </li>
</ul>

<p>
More information about the API classes is in the
<a href="http://code.google.com/apis/maps/documentation/flash/reference.html">http://code.google.com/apis/maps/documentation/flash/reference.html</a>
</p>

<h4>
onMapClick function:
</h4>

<pre class="prettyprint">
private function onMapClick(event:MapMouseEvent):void
{
  marker.setLatLng( event.latLng );
  ExternalInterface.call( "setPosition", marker.getLatLng().lat(), marker.getLatLng().lng() );
}
</pre>

<p>
When the map is clicked, a <code>MapMouseEvent.CLICK</code> event is
triggered. From the <code>addEventListener()</code> call in the 
<code>onMapReady()</code> function, the
<code>onMapClick()</code> function is called. 
The event parameter contains the <code>LatLng</code> value of the point
where the map was clicked. The function repositions the marker to the new
coordinates using <code>marker.setLatLng()</code> then makes a call to
the <code>ExternalInterface</code> "setPosition" to notify the WPF layer of the 
change of position of the marker.
(The <code>ExternalInterface</code> is discussed later in this article).
</p>

<h4>
onSearch function:
</h4>

<pre class="prettyprint">
private function onSearch(address:String):void
{
 // Geocoding example
 var geocoder:ClientGeocoder = new ClientGeocoder();

 geocoder.addEventListener(
   GeocodingEvent.GEOCODING_SUCCESS,
   function(event:GeocodingEvent):void {
     var placemarks:Array = event.response.placemarks;
     if (placemarks.length &gt; 0) {
       map.setCenter(placemarks[0].point);
       marker.setLatLng(placemarks[0].point);
       ExternalInterface.call("setPosition", marker.getLatLng().lat(), marker.getLatLng().lng() );
    }
  });
  geocoder.addEventListener(
    GeocodingEvent.GEOCODING_FAILURE,
    function(event:GeocodingEvent):void {
      Alert.show("Geocoding failed");
    });
  geocoder.geocode(address);
}
</pre>

<p>
When a "Search" call is received from the WPF layer through
the ExternalInterface, the <code>onSearch</code> function is called 
passing a single <code>address</code> parameter.
</p>

<p>
To convert an address into a <code>LatLng</code> value, we need to
create an instance of the <code>ClientGeocoder</code>, 
and make a call to <code>geocode()</code>. This call is asynchronous and the 
<code>ClientGeocoder</code> can fire two events as a response
to this call, <code>GeocodingEvent.GEOCODING_SUCCESS</code> and
<code>GeocodingEvent.GEOCODING_FAILURE</code>.
</p>

<p>
On success, we center the map to the new address, reposition
the marker and notify the WPF layer of the new position of the marker. On
failure we simply display an error message.
</p>

<h4>
ExternalInterface:
</h4>

<p>
We use two features of the Flex SDK to communicate
between the Google Maps control in Flex and the WPF layer;
<code>ExternalInterface.call()</code>
and <code>ExternalInterface.addCallback()</code>.
</p>

<p>
The <code>ExternalInterface.call()</code> method allows the AS3 code to send a
request to the host of the Flash control. The request is received by the host
as an XML message. So the call
</p>
<pre class="prettyprint">
ExternalInterface.call( "setPosition", marker.getLatLng().lat(), marker.getLatLng().lng() );
</pre>
<p>
is converted to:
</p>

<pre class="prettyprint">
&lt;invoke name="<b>setPosition</b>" returntype="xml"&gt;
  &lt;arguments&gt;
    &lt;number&gt;40.7077159&lt;/number&gt;
    &lt;number&gt;-74.0116411&lt;/number&gt;
  &lt;/arguments&gt;
&lt;/invoke&gt;
</pre>

<p>
The Flex environment also allows the Flash control to
receive requests from the host environment.
This functionality is used when an address is entered in WPF.
A "Search" request is sent by WPF to Flash as an XML message:
</p>

<pre class="prettyprint">
 &lt;invoke name="<b>Search</b>" returntype="xml"&gt;
  &lt;arguments&gt;
    &lt;string&gt;1 Wall Street, New York&lt;/string&gt;
   &lt;/arguments&gt;
&lt;/invoke&gt;
</pre>

<p>
We monitor request from the Host using
<code>ExternalInterface.addCallback</code>.
</p>

<li>

Once you've prepared your MXML file, compile it into a SWF
file using the mxmlc compiler.

<pre class="prettyprint">
C:\src\flash&gt;h:\flash_api_dev\flex_sdk_3\bin\mxmlc GoogleMaps.mxml -library-path+=h:\flash_api_dev\sdk\lib\map_flex_1_9.swc
Loading configuration file H:\flash_api_dev\flex_sdk_3\frameworks\flex-config.xml
C:\src\flash\GoogleMaps.swf (242361 bytes)
</pre>

</ol>

<h3>
Create an Interop library to embed Flash in WPF.
</h3>

<p>
WPF doesn't have native support for ActiveX controls but
ActiveX controls can be hosted in WPF using the WindowsFormsHost control.
To use this control, you need to create an Interop wrapper around the Flash
control. The source code provided with this project already includes the
necessary files, but if you need to recreate the Interop library, you can
either:
</p>

<h4>
Use the command line tool available in the .NET SDK:
</h4>

<pre class="prettyprint">
C:\src\flash&gt;"C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin\aximp.exe" C:\Windows\system32\Macromed\Flash\Flash10a.ocx
</pre>

<p>
The command-line tool is particularly useful if you need to be able to sign
your assemblies or if you would like to get the assemblies regenerated in a
batch process. See
<a href="http://msdn.microsoft.com/en-us/library/8ccdh774(VS.80).aspx">http://msdn.microsoft.com/en-us/library/8ccdh774(VS.80).aspx</a>
</p>

<p>
or
</p>

<h4>
Create a Winforms Library project:
</h4>

<p>
Microsoft Visual Studio automatically generates an AxHost
wrapper class for a Microsoft ActiveX control when the control is added to a
design surface. The following procedure creates a managed assembly named
AxInterop.ShockwaveFlashObjects.dll.
</p>

<ol>

<li>
Open Visual Studio

<li>
Create a Windows Forms control Library project and name the project FlashAxLib

<p>
  <img border=0 width=548 height=378 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image002.jpg">
</p>

<li>
In Solution Explorer, add a reference to the Shockwave Flash Player assembly:

<p>
  <img border=0 width=374 height=312 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image003.jpg">
</p>

<li>
Open the Toolbox.

<li>
Right-click in the Toolbox, and then click Choose Items.

<li>
Click the COM Components tab, select the Shockwave Flash control, and then click OK to accept the selection.

<p>
  <img border=0 width=457 height=322 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image004.jpg">
</p>

<p>
The Shockwave Flash Player control is added to the Toolbox.
</p>

<li>
In Solution Explorer, right-click the UserControl1 file, and then click Rename.

<li>
Change the name to FlashAxControl.cs or FlashAxControl.vb, depending on the language.

<li>
If you are prompted to rename all references, click Yes.

<li>
In the Windows Forms Designer, open FlashAxControl.

<li>
From the Toolbox, add the Shockwave Flash Player control to the design surface.

<li>
Press F6 to build the control library.

<li>
Look into the bin/Debug or bin/Release build folder of this
library and you will find the AxInterop.ShockwaveFlashObjects.dll and
Interop.ShockwaveFlashObjects.dll files.

</ol>

<h3>
Create a WPF application with Google Maps.
</h3>

<p>
We're now ready to create our demo application.
</p>

<ol>

<li>
First, create a standard WPF application, name it GoogleMapsFlashInWpf.

<p>
  <img border=0 width=547 height=377 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image005.jpg">
</p>

<li>
Add a reference to WindowsFormsIntegration:

<p>
  <img border=0 width=374 height=312 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image006.jpg">
</p>

<li>
And a reference to System.Windows.Forms:

<p>
  <img border=0 width=374 height=312 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image007.jpg">
</p>

<li>
  And a reference to the Shockwave Flash player AxInterop file generated in step 2:

<p>
  <img border=0 width=374 height=312 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image008.jpg">
</p>

<li>
  Change the content of Window1.xaml to:

<pre class="prettyprint">
&lt;Window x:Class="GoogleMapsFlashInWpf.Window1"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:wf="clr-namespace:System.Windows.Forms;assembly=System.Windows.Forms"
  xmlns:ax="clr-namespace:AxShockwaveFlashObjects;assembly=AxInterop.ShockwaveFlashObjects"
  Title="Hosting Google Maps Flash API in a WPF .NET Application"
  Loaded="WindowLoaded" MinHeight="400" MinWidth="600"&gt;
  &lt;Grid&gt;
    &lt;Grid.RowDefinitions&gt;
      &lt;RowDefinition Height="Auto" /&gt;
      &lt;RowDefinition Height="*" /&gt;
      &lt;RowDefinition Height="Auto" /&gt;
    &lt;/Grid.RowDefinitions&gt;
  &lt;Grid Margin="5,5,5,5" Grid.Row="0"&gt;
    &lt;Grid.ColumnDefinitions&gt;
      &lt;ColumnDefinition Width="Auto"/&gt;
      &lt;ColumnDefinition Width="*"/&gt;
      &lt;ColumnDefinition Width="Auto"/&gt;
    &lt;/Grid.ColumnDefinitions&gt;
    &lt;Label Margin="0,0,5,0" Grid.Column="0"&gt;Address:&lt;/Label&gt;
    &lt;TextBox Name="address" Grid.Column="1" KeyDown="TextBox_KeyDown"&gt;&lt;/TextBox&gt;
    &lt;Button Margin="5,0,0,0" Padding="10,0,10,0" Grid.Column="2" Click="Search_Click"&gt;Search&lt;/Button&gt;
  &lt;/Grid&gt;
  &lt;Border BorderThickness="1" BorderBrush="Blue" Grid.Row="1" Margin="5,5,5,5"&gt;
    &lt;WindowsFormsHost Name="wfh"&gt;
      &lt;ax:AxShockwaveFlash x:Name="axFlash"/&gt;
    &lt;/WindowsFormsHost&gt;
  &lt;/Border&gt;
    &lt;Grid Margin="5,5,5,5" Grid.Row="2"&gt;
      &lt;Grid.ColumnDefinitions&gt;
        &lt;ColumnDefinition Width="5*"/&gt;
        &lt;ColumnDefinition Width="5*"/&gt;
      &lt;/Grid.ColumnDefinitions&gt;
      &lt;StackPanel Grid.Column="0" Orientation="Horizontal"&gt;
        &lt;TextBlock Margin="0,0,5,0"&gt;Lat:&lt;/TextBlock&gt;
        &lt;TextBlock Name="lat"&gt;&lt;/TextBlock&gt;
      &lt;/StackPanel&gt;
      &lt;StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal"&gt;
        &lt;TextBlock Margin="0,0,5,0"&gt;Lng:&lt;/TextBlock&gt;
        &lt;TextBlock Name="lng"&gt;&lt;/TextBlock&gt;
      &lt;/StackPanel&gt;
    &lt;/Grid&gt;
  &lt;/Grid&gt;
&lt;/Window&gt;
</pre>

<p>
Note the AxShockwaveFlash control hosted inside the WindowsFormsHost control.
</p>

<li>
And change the Window1.xaml.cs file to:

<pre class="prettyprint">
using System;
using System.Linq;
using System.Xml.Linq;
using System.Windows;
using System.Windows.Input;

namespace GoogleMapsFlashInWpf
{
    ///
    /// Interaction logic for Window1.xaml
    ///
    public partial class Window1 : Window
    {
        public Window1()
        {
           InitializeComponent();
        }

        private void WindowLoaded(object sender, RoutedEventArgs e)
        {
           AxShockwaveFlashObjects.AxShockwaveFlash axFlash = wfh.Child as AxShockwaveFlashObjects.AxShockwaveFlash;
           axFlash.FlashVars = "key= your_api_key";
           axFlash.Movie = System.Windows.Forms.Application.StartupPath + "\\GoogleMaps.swf";

           axFlash.FlashCall += new AxShockwaveFlashObjects._IShockwaveFlashEvents_FlashCallEventHandler(axFlash_FlashCall);
        }

        void axFlash_FlashCall(object sender, AxShockwaveFlashObjects._IShockwaveFlashEvents_FlashCallEvent e)
        {
           XDocument call = XDocument.Parse(e.request);

           var q = from c in call.Elements("invoke")
                   select new
                    {
                       Name = c.Attribute("name").Value,
                       Arguments = c.Element("arguments").Descendants()
                   };
           foreach (var i in q)
           {
               if (i.Name == "setPosition")
               {
                   lat.Text = i.Arguments.ElementAt(0).Value;
                   lng.Text = i.Arguments.ElementAt(1).Value;
               }
           }

        }

        private void TextBox_KeyDown(object sender, KeyEventArgs e)
        {
           if (e.Key == Key.Enter)
               Search_Click(sender, null);
        }

        private void Search_Click(object sender, RoutedEventArgs e)
        {
           AxShockwaveFlashObjects.AxShockwaveFlash axFlash = wfh.Child as AxShockwaveFlashObjects.AxShockwaveFlash;

           XElement call = new XElement("invoke",
                   new XAttribute("name", "Search"),
                   new XAttribute("returntype", "xml"),
                   new XElement("arguments",
                       new XElement("string", address.Text)
                   )
               );
           axFlash.CallFunction(call.ToString(SaveOptions.DisableFormatting));
        }
    }
}
</pre>

<p>
Within this code, there are three elements to notice:
</p>

<ol>

<li>

On load, the Flash object is initialized with:

<pre class="prettyprint">
axFlash.FlashVars = "key= your_api_key";
axFlash.Movie = System.Windows.Forms.Application.StartupPath + "\\GoogleMaps.swf";
</pre>

<li>
A handler is added to the <code>FlashCall</code> event of the Flash
object to receive the <code>ExternalInterface.call()</code> calls from Flash.

<li>
In <code>axFlash_FlashCall</code>, we process the XML request received
from Flash, check the <code>Invoke.Name</code> attribute 
(it should be "setPosition") and change the values of <code>lat.Text</code> and 
<code>lng.Text</code> with the new latitude and longitude
values.

</ol>

<p>
When the Search button is clicked, we prepare an XML element
of type "invoke", set the "name" attribute and the arguments elements and call
the <code>CallFunction</code> method of the Flash control.
This request will be received inside Flash using
<code>ExternalInterface.addCallback</code>.
</p>

<li>
Finally, add the GoogleMaps.swf file in the project as a
Content object so it gets copied to the build folder on compilation:

<p>
  <img border=0 width=450 height=335 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image009.jpg">
</p>

<li>
Remember to change the Copy option and Build Action in the
properties of the GoogleMaps.swf file in the Solution Explorer:

<p>
  <img border=0 width=323 height=302 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image010.jpg">
</p>

<li>
Compile and execute ...

</ol>

<p>
To deploy, you need these files:
</p>

<p>
<img border=0 width=545 height=255 src="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/image011.jpg">
</p>

<h3>
Downloads:
</h3>

<p>
Google Maps MXML file<br>
<a href="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/GoogleMaps.mxml">GoogleMaps.mxml</a>
</p>

<p>
Compiled SWF file<br>
<a href="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/GoogleMaps.swf">GoogleMaps.swf</a>
</p>

<p>
Visual Studio 2008 project for the Flash Interop Library (Source)<br>
<a href="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/FlashAxLib_Src.zip">FlashAxLib_Src.zip</a>.
</p>

<p>
Flash Interop Library (.NET Assemblies)<br>
<a href="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/FlashAxLib.zip">FlashAxLib.zip</a>.
</p>

<p>
Visual Studio 2008 project for the Google Maps Demo (Source)<br>
<a href="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/GoogleMapsFlashInWpf_Src.zip">GoogleMapsFlashInWpf_Src.zip</a>.
</p>

<p>
Google Maps Demo (.NET Executable)<br>
<a href="http://gmaps-samples-flash.googlecode.com/svn/trunk/articles/wpf/GoogleMapsFlashInWpf.zip">GoogleMapsFlashInWpf.zip</a>.
</p>

<h3>
Reference:
</h3>

<p>
Google Maps API for Flash<br>
<a href="http://code.google.com/apis/maps/documentation/flash/">http://code.google.com/apis/maps/documentation/flash/</a>
</p>

<p>
Google Maps API for Flash - Flex SDK Tutorial<br>
<a href="http://code.google.com/apis/maps/documentation/flash/tutorial-flex">http://code.google.com/apis/maps/documentation/flash/tutorial-flex</a>.
</p>

<p>
Windows Forms ActiveX Control Importer (Aximp.exe)<br>
<a href="http://msdn.microsoft.com/en-us/library/8ccdh774(VS.80).aspx">http://msdn.microsoft.com/en-us/library/8ccdh774(VS.80).aspx</a>
</p>

<p>
Walkthrough: Hosting an ActiveX control in Windows Presentation Foundation by Using XAML<br>
<a href="http://msdn.microsoft.com/en-us/library/ms748870.aspx">http://msdn.microsoft.com/en-us/library/ms748870.aspx</a>
</p>

<p>
If you have any problems with or questions about this tutorial, please post in the
<a href="http://groups-beta.google.com/group/Google-Maps-API" target="_blank">Maps API forum.</a>
</p>

<!-- ########## END PAGE CONTENT ########## -->


      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
    &copy;2010 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>

