<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">







 
 


 

  
  
  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/apis/maps/articles/static+js.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Using Static Maps to Speed Up Your Dynamic Maps - Google Maps API Family - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/apis/maps/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../../css/iehacks.css"><![endif]-->

    <link href="../../../css/semantic_headers.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="gc-documentation">

    
    
    <div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  <a href="#gc-pagecontent">Skip to page content</a>
  <a href="#gc-toc">Skip to main navigation</a>
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
  
     <img src="../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "adwords" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Maps API Family</h1>
  <ul id="articles" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="../index.html" title="Google Maps API Family home page">Home</a>
    </li>
  
    <li id="faq_link">
      <a href="../faq.html" title="Answers to frequently asked questions about Google Maps API Family">FAQ</a>
    </li>
  
    <li id="articles_link">
      <a href="index.html" class="selected" title="Focused articles and tutorials for Google Maps API Family developers">Articles</a>
    </li>
  
    <li>
      <a href="http://googlegeodevelopers.blogspot.com/" title="Official Google Maps API Family blog">Blog</a>
    </li>
  
    <li>
      <a href="../forum/index.html" title="Google Maps API Family developer forum">Forum</a>
    </li>
  
    <li>
      <a href="../terms.html" title="Google Maps API Family terms of service">Terms</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->

    <div class="g-section g-tpl-170">

      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li><a href="../index.html">Maps API Family</a></li>
  <li><a href="http://code.google.com/apis/kml/documentation/kmlSearch.html">Index Your Maps Content</a></li>
</ul>
      <div class="line"></div>
      <ul>
        <li><h2>Maps Javascript API V3</h2>
         <ul>
           <li><a href="../documentation/javascript/index.html">Home Page</a></li>
           <li><a href="../documentation/javascript/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
      <ul>
        <li><h2>Maps Javascript API V2</h2>
         <p><span style="color:grey">(Deprecated API)</span></p>
         <ul>
           <li><a href="../documentation/javascript/v2/index.html">Home Page</a></li>
           <li><a href="../documentation/javascript/v2/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
  <div class="line"></div>
    <ul>
      <li><h2>Maps API for Flash</h2>
        <ul>
          <li><a href="../documentation/flash/index.html">Home Page</a></li>
          <li><a href="../documentation/flash/intro.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
    <div class="line"></div>
    <ul>
      <li><h2>Maps Data API</h2>
        <p><span style="color:grey">(Deprecated API)</span></p>
        <ul>
          <li><a href="../documentation/mapsdata/index.html">Home Page</a></li>
          <li><a href="../documentation/mapsdata/developers_guide_protocol.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
     <div class="line"></div>
      <ul>
        <li><h2><a href="../documentation/webservices/index.html">Maps Web Services</a></h2>
         <ul>
           <li><a href="../documentation/geocoding/index.html">Geocoding Guide</a></li>
           <li><a href="../documentation/directions/index.html">Directions Guide</a></li>
           <li><a href="../documentation/elevation/index.html">Elevation Guide</a></li>
           <li><a href="../documentation/places/index.html">Places Guide</a></li>
         </ul>
       </li>
      </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Static Maps API</h2>
            <ul>
              <li><a href="../documentation/staticmaps/index.html">Developer Guide</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Earth API</h2>
            <ul>
              <li><a href="http://code.google.com/apis/earth">Home Page</a></li>
              <li><a href="http://code.google.com/apis/earth/documentation">Documentation</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li>
            <h2>Local Search API</h2>
            <p><span style="color:grey">(Deprecated API)</span></p>
            <ul>
              <li>
                <a href="../documentation/localsearch/index.html">Home Page</a>
              </li>
              <li>
                <a href="../documentation/localsearch/start.html">Documentation</a>
              </li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
      <div class="promo">
     <p><a href="../documentation/premier/index.html">Google Maps API Premier</a></p><p>Includes enterprise licensing and support</p></div>

        <a class="hidden" href="#gc-topnav-anchor">More Google Maps API Family resource links</a>
      </div>
      
      <div class="g-unit" id="gc-pagecontent">
        <h1 class="page_title">Using Static Maps to Speed Up Your Dynamic Maps</h1>


<!-- ########## PAGE CONTENT ########## -->
  
<div class=i>
<i>Tom Manshreck, Google Maps API Team</i>
<br>
<i>September 2009</i>

<p class="para">
This tutorial illustrates how to use a map created using the
Static Maps API to quickly display a map within your application, and then
replace it with a map using the JavaScript Maps API once the page has loaded.
Doing so can help websites with high latency provide a map to
their users more quickly, and is especially useful for developers
creating maps for mobile applications.</p>

<p>The techniques explained in this article are not esoteric. We liked
this approach so much that we use this same technique when loading maps
within <a href="../documentation/javascript/index.html"> V3 of the Google Maps
API</a>!</p>

<h2 id="Introduction">Topic Outline</h2>

<p>This article explores several topics which together make this
technique possible. They include:</p>

<ul>
<li>Specifying the stacking order of <code>&lt;div&gt;</code> elements using
the <code>z-index</code> property</li>
<li>Delay-loading the JavaScript Maps API</li>
<li>Monitoring the <code>"tilesloaded"</code> event to determine when a map
is ready to display</li>
<li>Using the <a href="../documentation/staticmaps/index.html">Static Maps API
</a> to create a copy of the initial dynamic map</li>
<li>Arranging your maps so that you provide a seamless user experience during
the transition from static to dynamic maps</li>
</ul>

<p>We'll explain each of these topics below.</p>

<h2 id="DynamicMap">Setting Up Your JavaScript Map</h2>

<p>Before we do anything tricky, let's first set up a standard
JavaScript map. We'll illustrate a typical mobile use case: a listing
and display of store locations. The following code contains an array noting
theses locations, and creates a map with markers at each location:</p>


<pre class="prettyprint">
/*
* Sets up the dynamic Google Maps API
*/
function loadMap() {
  var map = new GMap2(document.getElementById("map_canvas"));
  map.setCenter(new GLatLng(-33.8739340, 151.1751510), 12);
  map.addControl(new GSmallMapControl());

  //add the store markerS

  var storeMarkers = [
    [ 'Ashfield NSW',-33.889533, 151.125862],
    [ 'Haymarket NSW',-33.880777, 151.202796],
    [ 'Sydney NSW',-33.867139, 151.207114],
    [ 'Leichhardt NSW',-33.883793, 151.157057],
    [ 'Newtown NSW',-33.896449, 151.180013],
    [ 'Marrickville NSW',-33.910923, 151.157187],
    [ 'Drummoyne NSW',-33.851056, 151.154542]
  ]

  for (var i = 0; i < storeMarkers.length; i++) {
    var store = storeMarkers[i];
    var myLatLng = new GLatLng(store[1], store[2]);
    map.addOverlay(new GMarker(myLatLng));
  }
}
</pre>


<p>Note that we've pre-geocoded our store addresses in this case. If
you need to geocode a set of known addresses, you can use our 
<a href="../documentation/geocoding/index.html">Geocoding Service</a>.</p>

<p>The code above should be fairly standard to most developers who are
familiar with the Maps API. If you're unfamiliar with it, please
consult the main <a href="../documentation/v2">JavaScript Maps API
V2 documentation</a>.</p>

<h2 id="SortOrders">Specifying the Stacking Order of Your Map Elements</h2>

<p>We now need to create a <code>&lt;div&gt;</code> to hold the map.
This <code>&lt;div&gt;</code> is similar to that which you're
already familiar but with one key difference: we set the 
<code>&lt;div&gt;</code>'s <code>z-index</code> value as well.</p>

<pre class="prettyprint">
&lt;div id="map_canvas" style="position:absolute;width:320px;height:480px;z-index:1"&gt;&lt;/div&gt;
</pre>

<p>The <code>z-index</code> defines the stacking order of objects within the
browser's DOM. The technique illustrated in this tutorial relies on placing a
static map on "top" of the JavaScript map, while loading the dynamic map
underneath, so we'll set this value to <code>1</code>. (We'll specify the
static map to have a higher <code>z-index</code> than this value.)</p>

<h2 id="StaticMap">Creating Your Static Map</h2>

<p>We now want to create a static map. We'll also want to ensure the created
image matches the dynamic map as closely as possible so that the maps align
correctly.</p>

<p>The static map service, as documented within the 
<a href="../documentation/staticmaps/index.html"> Static Map Developer Guide
</a>, is an HTTP service which creates and retrieves a map image based on
parameters passed into its URL. We'll set the <code>src</code> of an 
<code>&lt;img&gt;</code> tag to this HTTP URL. Additionally, we'll set this
<code>&lt;img&gt;</code>'s <code>z-index</code> to a higher number than that
for the map's <code>&lt;div&gt;</code>. This will ensure that the static map
appears above the dynamic map.</p>

<p>We need to be careful to create a static map that is nearly identical to
the dynamic map, so that the transition of static to dynamic map appears
seamless to the user. To create an identical map, we'll set its size to that
of the map's <code>&lt;div&gt;</code> above, pass an identical 
<code>center</code> parameter and pass the markers as the same series of 
latitude/longitude pairs noted above.</p>

<pre class="prettyprint">
&lt;img style="position:absolute;z-index:2" id="staticmap" 
src="http://maps.google.com/maps/api/staticmap?center=-33.8739340,151.1751510
&amp;markers=color:green|label:G|-33.889533,151.125862|<i>ADDITIONAL_GEOCODES</i>&amp;key=<i>YOUR_API_KEY</i>&amp;zoom=12&amp;size=320x480&amp;sensor=false"&gt;
</pre>

<p>(Note that we didn't list all of the latitude/longitude combinations
in the <code>staticmap</code> URL in order to make the code easier to read.
As well, the Static Maps API now supports geocoding directly within its URL
parameters. However, since we've already geocoded these locations, we
supplied them directly to the service.)</p>

<h2 id="TileLoading">Determining When the Dynamic Map is Ready</h2>

<p>Once the JavaScript map is ready, we'll want to remove the static map.
The Google Maps API provides a special <code>"tilesloaded"</code> event 
indicating when the dynamic map has loaded all of its map tiles. We'll add a
listener to our <code>loadMap()</code> method, asking it to invoke a 
<code>removeStaticMap()</code> method once the tiles are loaded:</p>

<pre class="prettyprint">
  // Add an event listener on the tilesloaded event
  // When tiles are ready, remove the map
  GEvent.addListener(map, "tilesloaded", removeStaticMap);
</pre>

<p>The <code>removeStaticMap()</code> method is fairly simple. We wait a
few seconds (to avoid flickering) and then set the <code>z-index</code>
of the static map to a value lower than that of the dyanmic map:</p>

<pre class="prettyprint">
function removeStaticMap() {
  setTimeout(pushStaticMap,2000);
  
  function pushStaticMap() {
    var staticMapImage = document.getElementById("staticmap");
    staticMapImage.style.zIndex = 0;
  }
}
</pre>

<h2 id="Containers">Creating Your Containing Elements</h2>

<p>We'll now create a container <code>&lt;div&gt;</code> to hold both our map
<code>&lt;div&gt;</code> and our <code>&lt;img&gt;</code> element as siblings.
Note that both of these elements have their position set to 
<code>absolute</code>. This ensures that the two elements appear at the same
exact location within the container. We'll also set the static map's markers
to green so we can clearly see when the map transitions from static to
dynamic:</p>

<pre class="prettyprint">
&lt;div id="blurb" style="width: 320px;"&gt;
  &lt;p&gt;This page loads a static map first, and then loads the JS API by callback. 
  When the JS API has finished loading, it removes the static map.&lt;/p&gt;
  &lt;div id="mapcontainer" style="position:relative"&gt;
    &lt;div id="map_canvas" style="position:absolute;width:320px;height:480px;z-index:1"&gt;&lt;/div&gt;
    &lt;img style="position:absolute;z-index:2" id="staticmap" 
        src="http://maps.google.com/maps/api/staticmap?center=-33.8739340,151.1751510
        &markers=color:green|label:G|-33.889533,151.125862|<i>ADDITIONAL_GEOCODES</i>&amp;key=<i>YOUR_API_KEY</i>&amp;zoom=12&amp;size=320x480&amp;sensor=false"&gt;
  &lt;/div&gt;
&lt;/div&gt;
</pre>

<h2 id="DelayLoading">Delay-Loading the JavaScript Maps API</h2>

<p>One more performance tweak is left. Because we're displaying a static map
first, we don't need to immediately display a dynamic map and can optimize the
page by <i>delay loading</i> the JavaScript Maps API. This ensures that the
browser concentrates on loading everything else in the page first, including
the static map. To enable delay-loading, we'll move all of our JavaScript
after the page's <code>&lt;body&gt;</code> tag, including the 
<code>&lt;script&gt;</code> for loading the JavaScript Maps API bootstrap.</p>

<p>We'll also load the JavaScript Maps API asynchronously, indicating that we
wish to have the JavaScript interpreted <i>after</i> the page loads. To do so,
we'll add two special parameters to the Maps API bootstrap request:</p>

<ul>
<li><code>async=2</code> indicates that we wish to delay load the Maps API.</li>
<li><code>callback</code> indicates the function to invoke once the Maps API 
has been loaded asynchronously.</li>
</ul>

<p>We'll set the <code>callback</code> to our original <code>loadMap()</code>
method. Note that calling the JavaScript code in this manner is different than
the standard way within the <code>&lt;body&gt;</code> tag's <code>onload</code>
handler.</p>

<pre class="prettyprint">
&lt;script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=<i>YOUR_API_KEY</i>&amp;sensor=false&amp;async=2&amp;callback=loadMap" type="text/javascript"&gt;
</pre>

<h2 id="Wrap">Wrapping It All Up</h2>

<p>We now have everything we need to create a static map and a delay-loaded
JavaScript map. The samples below contain our finished maps. The <code>static+js-debug</code>
map displays markers from the static map in a different color than those in the
dynamic map so you can more easily see the difference.</p>

<p><a href="../documentation/javascript/v2/examples/static+js-debug.html">View example (static+js-debug.html)</a></p>

<p><a href="../documentation/javascript/v2/examples/static+js-final.html">View final example with same marker styles (static+js-final.html)</a></p>

<p>If you're interested in creating mobile map applications, be sure to check out our new
<a href="../documentation/javascript/index.html">V3 Maps API</a>, which we're redesigning from the
ground up for increased usability on mobile browsers.</p>


<!-- ########## END PAGE CONTENT ########## -->
  
   
      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
    &copy;2010 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>

