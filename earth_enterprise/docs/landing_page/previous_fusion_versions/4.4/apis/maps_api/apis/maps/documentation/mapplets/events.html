<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">








 
 





  


  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/apis/maps/documentation/mapplets/events.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Mapplet Events - Google Mapplets - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/html/apis/maps/documentation/mapplets/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../../../css/iehacks.css"><![endif]-->

<link href="../local_extensions.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="gc-documentation">

    <div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container" class="depr">
<a id="top"></a>
<div id="skipto">
  
  
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
  
     <img src="../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "adwords" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Mapplets (<a href="../../terms.html#section_4_4">Deprecated</a>)</h1>
  <ul id="docs" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="index.html" title="Google Mapplets home page">Home</a>
    </li>
  
    <li id="docs_link">
      <a href="guide.html" class="selected" title="Official Google Mapplets documentation">Docs</a>
    </li>
  
    <li id="faq_link">
      <a href="../../faq.html" title="Answers to frequently asked questions about Google Mapplets">FAQ</a>
    </li>
  
    <li id="articles_link">
      <a href="articles.html" title="Focused articles and tutorials for Google Mapplets developers">Articles</a>
    </li>
  
    <li>
      <a href="http://googlegeodevelopers.blogspot.com/" title="Official Google Mapplets blog">Blog</a>
    </li>
  
    <li>
      <a href="http://groups.google.com/group/google-mapplets/" title="Google Mapplets developer forum">Forum</a>
    </li>
  
    <li>
      <a href="../../terms.html" title="Google Mapplets terms of service">Terms</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->

    <div class="g-section g-tpl-170">

      <a name="gc-toc-anchor"></a>  
      <div class="g-unit g-first" id="gc-toc">
          <ul>
    <li><a href="../../index.html">Maps API Family</a></li>
    <li><a href="http://maps.google.com/gadgets/directory?synd=mpl">Mapplets Directory</a></li>
    </ul>
  <div class="line"></div>
    <ul>
      <li><h2>Mapplets API</h2>
                <ul>
                  <li><a class="tlw-expanded" href="guide.html">Developer Guide</a>
                    <ul>
                      <li><a href="basics.html">Basics</a></li>
                      <li><a href="events.html">Events</a></li>
                      <li><a href="overlays.html">Overlays</a></li>
                      <li><a href="services.html">Services</a></li>
                    </ul>                               
                  </li>
                  <li><a href="reference.html">API Reference</a></li>
                  <li><a href="infowindowallowed.html">Content Allowed in Mapplet Info Windows</a></li>
               <li><h2 class="tlw-expanded">More Resources:</h2>
               <ul>
               <li><a href="demogallery.html">Demos</a></li>
               <li><a href="articles.html">Articles</a></li>
               <li><a href="mediagallery.html">Presentations</a></li>
               <li><a href="http://code.google.com/p/gmaps-api-issues/issues/list?can=2&q=apitype%3AMapplets&colspec=ID+Type+Status+Introduced+Fixed+Summary+Internal+Stars&cells=tiles">Known Issues</a></li>
               <li><a href="http://code.google.com/p/gmaps-api-issues/wiki/MappletsAPIChangelog">Changelog</a><sup class="new">New!</sup></li>
              </ul>
                </ul>
              </li>
      </li>
    </ul>   
      <div class="line"></div>
      <ul>
        <li><h2>Maps JavaScript API V3</h2>
         <ul>
           <li><a href="../javascript/index.html">Home Page</a></li>
           <li><a href="../javascript/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
      <ul>
        <li><h2>Maps Javascript API V2</h2>
         <p><span style="color:grey">(Deprecated API)</span></p>
         <ul>
           <li><a href="../javascript/v2/index.html">Home Page</a></li>
           <li><a href="../javascript/v2/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
    <div class="line"></div>
    <ul>
      <li><h2>Maps API for Flash</h2>
        <ul>
          <li><a href="../flash/index.html">Home Page</a></li>
          <li><a href="../flash/intro.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
  <div class="line"></div>
    <ul>
      <li><h2>Maps Data API</h2>
        <p><span style="color:grey">(Deprecated API)</span></p>
        <ul>
          <li><a href="../mapsdata/index.html">Home Page</a></li>
          <li><a href="../mapsdata/developers_guide_protocol.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
      <div class="line"></div>
    <ul>
        <li><h2><a href="../webservices/index.html">Maps API Web Services</a></h2>
        <ul>
          <li><a href="../geocoding/index.html">Geocoding API</a></li>
          <li><a href="../directions/index.html">Directions API</a></li>
          <li><a href="../elevation/index.html">Elevation API</a></li>
          <li><a href="../places/index.html">Places APl</a></li>
        </ul>
      </li>
    </ul>
       <div class="line"></div>
        <ul>
          <li><h2>Static Maps API</h2>
            <ul>
              <li><a href="../staticmaps/index.html">Developer Guide</a></li>
            </ul>
          </li>
        </ul>
    <div class="line"></div>
        <ul>
          <li><h2>Earth API</h2>
            <ul>
              <li><a href="http://code.google.com/apis/earth">Home Page</a></li>
              <li><a href="http://code.google.com/apis/earth/documentation">Documentation</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Local Search API</h2>
            <p><span style="color:grey">(Deprecated API)</span></p>
            <ul>
              <li>
                <a href="../localsearch/index.html">Home Page</a>
              </li>
              <li>
                <a href="../localsearch/start.html">Documentation</a>
              </li>
            </ul>
          </li>
        </ul>
    <div class="line"></div>
          <div class="promo"><p><a href="../premier/index.html">Google Maps API Premier</a></p><p>Includes enterprise licensing and support</p></div>

      </div>
      
      <a name="gc-pagecontent-anchor"></a>   
      <div class="g-unit" id="gc-pagecontent">
        <h1 class="page_title">Mapplet Events</h1>


<p class="note">Note: The Google Mapplets API has been officially
deprecated as of May 19, 2010. Existing Mapplets will continute
to be supported, but no new Mapplets will be accepted into the
Mapplets Gallery.</p>


<div>
<ol class="toc">
 <li><a href="#Events_Overview">Events Overview</a>
  <ol>
    <li><a href="#Event_Listeners">Event Listeners</a></li>
    <li><a href="#Event_Closures">Event Closures</a></li>
    <li><a href="#Event_Arguments">Event Arguments</a></li>
    <li><a href="#DOM_Events">DOM Events</a></li>
    <li><a href="#Removing_Event_Listeners">Removing Event Listeners</a></li>
  </ol>
  </li>
</ol>
</div>

<h1><a name="Events_overview" id="Events_overview"></a>Mapplet Events Overview</h1>

<p>JavaScript within the browser is <i>event driven</i>, meaning that
JavaScript responds to interactions by generating events, and expects
a program to <i>listen</i> to interesting events. For example, within 
browsers, user mouse and keyboard interactions create
events that propagate within the DOM. Programs interested in
certain events will register JavaScript <b>event listeners</b> for those events
and execute code when those events are received.</p>

<p>The Google Mapplets API adds to this event model by defining custom events 
for Mapplet objects. It is important to note that the Mapplets API events
are separate and distinct from the standard DOM events. However, as different
browsers implement different DOM event models, the Mapplets API also provides 
mechanisms to listen for and respond to these DOM events without needing to 
handle the various cross-browser peculiarities.</p>

<h1><a name="Event_Listeners" id="Event_Listeners"></a>Event Listeners</h1>

<p>Events in the Mapplets API are handled by using utility functions
within the <code>GEvent</code> namespace to register event listeners.
Each Mapplets API object exports a number of named events. For example, 
the <code>GMap2</code> object exports <code>click</code>, 
<code>dblclick</code>, and <code>move</code> events, and a host of 
others as well. Each event happens within a given context, and can pass 
arguments that identify that context. For example, the <code>dragstart</code> 
event fires when the user clicks and holds the mouse within a map object, and 
passes the <code>GLatLng</code> of the geographic location in which 
the mouse is located.</p>

<p>For a complete list of <code>GMap2</code> events and the arguments they 
generate, see <a href="reference.html#Events_GMap">GMap2.Events</a>.</p>

<p>To register for notification of these events, use the static method 
<code>GEvent.addListener()</code>. That method takes an object, 
an event to listen for, and a function to call when the specified 
event occurs. For example, this code snippet shows an alert every time the user 
clicks on the map:</p>

<pre class="prettyprint">
var map = new GMap2();

GEvent.addListener(map, "click", function(marker, point) {
  if (marker) {
    map.removeOverlay(marker);
  } else {
    map.addOverlay(new GMarker(point));
  }
});
</pre>

<p><a href="http://maps.google.com/maps/mpl?moduleurl=http://code.google.com/apis/maps/documentation/mapplets/examples/event-simple.xml">
Run this example</a> (<a href="examples/event-simple.xml">event-simple.xml</a>)</p>

<p>Listeners are also able to capture the context of the event.
In the following example code, we display the latitude and longitude 
of the center of the map after the user drags the map.</p>

<pre class="prettyprint">
var map = new GMap2();
GEvent.addListener(map, "moveend", function() {
  map.getCenterAsync(function(center) {
    map.openInfoWindowHtml(center, center.toString());
  });
});
map.setCenter(new GLatLng(37.4419, -122.1419), 13);
</pre>

<p><a href="http://maps.google.com/maps/mpl?moduleurl=http://code.google.com/apis/maps/documentation/mapplets/examples/event-context.xml">
Run this example</a> (<a href="examples/event-context.xml">event-context.xml</a>)</p>

<h1><a name="Event_Closures" id="Event_Closures"></a>Using Closures in Event Listeners</h1>

<p>When executing an event listener, it is often advantageous to have both private and persistent 
data attached to an object. JavaScript does not support "private" instance data, but it does
support <a href="http://www.jibbering.com/faq/faq_notes/closures.html" rel="nofollow">closures</a>
which allows inner functions to access outer variables. Closures are useful within event
listeners to access variables not normally attached to the objects on which events occur.</p>

<p>The following example uses a function closure in the event listener to assign sequential number values
to a set of markers. Clicking on each marker will display a different value, which is not 
contained within the marker itself.</p>

<pre class="prettyprint">
var map = new GMap2();

// Creates a marker at the given point with the given number label
function createMarker(point, number) {
  var marker = new GMarker(point);
  GEvent.addListener(marker, "click", function() {
    marker.openInfoWindowHtml("Marker #" + number);
  });
  return marker;
}

// Add 10 markers to the map at random locations
map.getBoundsAsync(function(bounds) {
  var southWest = bounds.getSouthWest();
  var northEast = bounds.getNorthEast();
  var lngSpan = northEast.lng() - southWest.lng();
  var latSpan = northEast.lat() - southWest.lat();

  for (var i = 0; i < 10; i++) {
    var point = new GLatLng(southWest.lat() + latSpan * Math.random(),
                            southWest.lng() + lngSpan * Math.random());
    map.addOverlay(createMarker(point, i + 1));
  }
});
</pre>

<p><a href="http://maps.google.com/maps/mpl?moduleurl=http://code.google.com/apis/maps/documentation/mapplets/examples/event-closure.xml">
Run this example</a> (<a href="examples/event-closure.xml">event-closure.xml</a>)</p>

<h1><a name="Event_Arguments" id="Event_Arguments"></a>Using Passed Arguments in Events</h1>

<p>Many events in the Mapplets API event system pass arguments when the event is
triggered. For example, the <code>GMap2</code> "click" event passes two
arguments (<code>overlay,point</code>) in the event. You can access these
arguments by passing the specified symbols directly to the functions within the
event listeners.</p>

<p>For example, the <code>"click"</code> event on a map passes an <code>overlay
</code> and <code>point</code> argument. We pass these arguments directly within
the callback function to invoke within the event listener.</p>

<p>Notice that we need to make two asynchronous requests in this example to
  retrieve the pixel coordinates and current zoom level. We use
  <code>GAsync()</code> to process these requests in parallel before we
  initiate the callback method based on those return values.</p>

<pre class="prettyprint">
  var map = new GMap2();
  map.setCenter(new GLatLng(37.4419, -122.1419), 13);

  GEvent.addListener(map,"click", function(overlay,point) {
    if (point) {
      GAsync(map, 'fromLatLngToDivPixel', [point], 'getZoom', function(divPixel, zoom) {
        var myHtml = "The GPoint value is: " + divPixel + " at zoom level " + zoom;
        map.openInfoWindow(point, myHtml);
      });
    }
  });
</pre>

<p><a href="http://maps.google.com/maps/mpl?moduleurl=http://code.google.com/apis/maps/documentation/mapplets/examples/event-arguments.xml">
Run this example</a> (<a href="examples/event-arguments.xml">event-arguments.xml</a>)</p>

<h1><a name="DOM_Events" id="DOM_Events"></a>Listening to DOM Events</h1>

<p>The Mapplets API event model creates and manages its own custom events.
However the DOM also creates and dispatches its own events, according
to the particular browser event model in use. If you wish to capture and respond
to these events, the Mapplets API provides browser-neutral wrappers to listen 
and bind DOM events, without the need for custom code. Note that a mapplet
can only listen to DOM events within its own &lt;iframe&gt;.</p>

<p>The <code>GEvent.addDomListener()</code> static method registers an
event handler for a DOM event on a DOM node. Similarly, the
static method <code>GEvent.bindDom()</code> allows you to register
event handlers for DOM events on class instances.</p>

<h1><a name="Removing_Event_Listeners" id="Removing_Event_Listeners"></a>
Removing Event Listeners</h1>

<p>When an event listener is no longer needed, you should remove it. This
is especially important in Mapplets as the listeners introduce extra
communication overhead. Removing event listeners that were defined 
via anonymous functions within closures can be difficult. However, the 
<code>addListener()</code>, <code>addDomListener()</code>, <code>bind()</code>, 
and <code>bindDom()</code> functions return a <code>GEventListener</code> 
handle, which can be used to eventually deregister the handler.</p>

<p>The following example responds to a click by placing a marker on the 
map. Any subsequent click removes the event listener. Notice that the <code>removeOverlay()</code>
code is never executed as a result. Also, notice that you can remove
an event listener even from within the event listener itself.</p>

<pre class="prettyprint">
function MyApplication() {
  this.counter = 0;
  this.map = new GMap2();
  this.map.setCenter(new GLatLng(37.4419, -122.1419), 13);
  var myEventListener = GEvent.bind(this.map, &quot;click&quot;, this, function(marker,point) {
    if (this.counter == 0) {
      if (point) {
        this.map.addOverlay(new GMarker(point))
        this.counter++;
      } else {
        this.removeOverlay(marker)
      }
    } else {
      GEvent.removeListener(myEventListener);
    }
  }); 
}
var application = new MyApplication();
</pre>

<p><a href="http://maps.google.com/maps/mpl?moduleurl=http://code.google.com/apis/maps/documentation/mapplets/examples/event-removal.xml">
Run this example</a> (<a href="examples/event-removal.xml">event-removal.xml</a>)</p>

<p>Continue on to the <a href="overlays.html">Mapplet Overlays</a>.</p>

        <!-- end body text -->

        <!-- end body text -->
   
      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
    &copy;2010 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>

