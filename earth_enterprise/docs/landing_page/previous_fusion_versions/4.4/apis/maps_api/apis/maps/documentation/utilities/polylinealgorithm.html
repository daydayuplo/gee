<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">







 
 


 

  

  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/apis/maps/documentation/utilities/polylinealgorithm.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Encoded Polyline Algorithm Format - Google Maps API Family - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/apis/maps/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../../../css/iehacks.css"><![endif]-->

<link href="../local_extensions.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="gc-documentation">

    <div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  
  
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
  
     <img src="../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "adwords" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Maps API Family</h1>
  <ul id="docs" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="../../index.html" title="Google Maps API Family home page">Home</a>
    </li>
  
    <li id="faq_link">
      <a href="../../faq.html" title="Answers to frequently asked questions about Google Maps API Family">FAQ</a>
    </li>
  
    <li id="articles_link">
      <a href="../../articles/index.html" title="Focused articles and tutorials for Google Maps API Family developers">Articles</a>
    </li>
  
    <li>
      <a href="http://googlegeodevelopers.blogspot.com/" title="Official Google Maps API Family blog">Blog</a>
    </li>
  
    <li>
      <a href="../../forum/index.html" title="Google Maps API Family developer forum">Forum</a>
    </li>
  
    <li>
      <a href="../../terms.html" title="Google Maps API Family terms of service">Terms</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->

    <div class="g-section g-tpl-170">

      <a name="gc-toc-anchor"></a>  
      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li><a href="../../index.html">Maps API Family</a></li>
  <li><a href="http://code.google.com/apis/kml/documentation/kmlSearch.html">Index Your Maps Content</a></li>
</ul>
      <div class="line"></div>
      <ul>
        <li><h2>Maps Javascript API V3</h2>
         <ul>
           <li><a href="../javascript/index.html">Home Page</a></li>
           <li><a href="../javascript/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
      <ul>
        <li><h2>Maps Javascript API V2</h2>
         <p><span style="color:grey">(Deprecated API)</span></p>
         <ul>
           <li><a href="../javascript/v2/index.html">Home Page</a></li>
           <li><a href="../javascript/v2/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
  <div class="line"></div>
    <ul>
      <li><h2>Maps API for Flash</h2>
        <ul>
          <li><a href="../flash/index.html">Home Page</a></li>
          <li><a href="../flash/intro.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
    <div class="line"></div>
    <ul>
      <li><h2>Maps Data API</h2>
        <p><span style="color:grey">(Deprecated API)</span></p>
        <ul>
          <li><a href="../mapsdata/index.html">Home Page</a></li>
          <li><a href="../mapsdata/developers_guide_protocol.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
     <div class="line"></div>
      <ul>
        <li><h2><a href="../webservices/index.html">Maps Web Services</a></h2>
         <ul>
           <li><a href="../geocoding/index.html">Geocoding Guide</a></li>
           <li><a href="../directions/index.html">Directions Guide</a></li>
           <li><a href="../elevation/index.html">Elevation Guide</a></li>
           <li><a href="../places/index.html">Places Guide</a></li>
         </ul>
       </li>
      </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Static Maps API</h2>
            <ul>
              <li><a href="../staticmaps/index.html">Developer Guide</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Earth API</h2>
            <ul>
              <li><a href="http://code.google.com/apis/earth">Home Page</a></li>
              <li><a href="http://code.google.com/apis/earth/documentation">Documentation</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li>
            <h2>Local Search API</h2>
            <p><span style="color:grey">(Deprecated API)</span></p>
            <ul>
              <li>
                <a href="../localsearch/index.html">Home Page</a>
              </li>
              <li>
                <a href="../localsearch/start.html">Documentation</a>
              </li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
      <div class="promo">
     <p><a href="../premier/index.html">Google Maps API Premier</a></p><p>Includes enterprise licensing and support</p></div>

      </div>
      
      <a name="gc-pagecontent-anchor"></a>   
      <div class="g-unit" id="gc-pagecontent">
        <h1 class="page_title">Encoded Polyline Algorithm Format</h1>

   

<p>Encoded polylines store two types of encoded information for any given set of points: the 
latitude and longitudes of those points, and the maximum zoom levels to display these points. 
Levels are encoded using unsigned values, while point coordinates need to use signed values, 
so the encoding process is slightly different for each case. This process is noted below. 
If you only have a few static points, you may also wish to use the interactive 
<a href="polylineutility.html">polyline encoding utility</a>.</p>

<h2>Encoding Latitudes and Longitudes</h2>

<p>The encoding process converts a binary value into a series of character codes for 
ASCII characters using the familiar base64 encoding scheme: to ensure proper display 
of these characters, encoded values are summed with 63 (the ASCII character '?') 
before converting them into ASCII. The algorithm also checks for additional 
character codes for a given point by checking the least significant bit of each
 byte group; if this bit is set to 1, the point is not yet fully formed and 
 additional data must follow.</p>

<p>Additionally, to conserve space, <b>points only include the offset from the 
previous point</b> (except of course for the first point). All points are encoded 
in Base64 as signed integers, as latitudes and longitudes are signed values. 
The encoding format within a polyline needs to represent two coordinates 
representing latitude and longitude to a reasonable precision. Given a maximum 
longitude of +/- 180 degrees to a precision of 5 decimal places 
(180.00000 to -180.00000), this results in the need for a 32 bit signed 
binary integer value.</p>

<p><span class="new">Note that the backslash is interpreted as an escape character 
within string literals. </span> Any output of this utility should convert backslash 
characters to double-backslashes within string literals.</p>

<p>The steps for encoding such a signed value are specified below.</p>

<ol>
<li>Take the initial signed value:<br/>
<b>-179.9832104</b>
</li>
<li>Take the decimal value and multiply it by 1e5, rounding the result:<br/>
<b>-17998321</b>
</li>
<li>Convert the decimal value to binary. Note that a negative value must be 
calculated using its <a href="http://en.wikipedia.org/wiki/Two%27s_complement">
two's complement</a> by inverting the binary value and adding one to the result:<br/>
<b>00000001 00010010 10100001 11110001<br/>
11111110 11101101 01011110 00001110<br/>
11111110 11101101 01011110 00001111</b>
</li>
<li>Left-shift the binary value one bit:<br/>
<b>11111101 11011010 10111100 00011110</b>
</li>
<li>If the original decimal value is negative, invert this encoding:<br/>
<b>00000010 00100101 01000011 11100001</b>
</li>
<li>Break the binary value out into 5-bit chunks (starting from the right hand side):<br/>
<b>00001 00010 01010 10000 11111 00001</b>
</li>
<li>Place the 5-bit chunks into reverse order:<br/>
<b>00001 11111 10000 01010 00010 00001</b>
</li>
<li>OR each value with 0x20 if another bit chunk follows:<br/>
<b>100001 111111 110000 101010 100010 000001</b>
</li>
<li>Convert each value to decimal:<br/>
<b>33 63 48 42 34 1</b>
</li>
<li>Add 63 to each value:<br/>
<b>96 126 111 105 97 64</b>
</li>
<li>Convert each value to its ASCII equivalent:<br/>
<b>`~oia@</b>
</li>
</ol>

<p>The table below shows some examples of encoded points, showing the 
encodings as a series of offsets from previous points.</p>

<div class="example">
  <h3>Example</h3>

  <div class="content">
    <p>Points: (38.5, -120.2), (40.7, -120.95), (43.252, -126.453)</p>

    <br/>
    <br/>

    <table class="grid">
    <tr class="header">
    <td>Latitude</td>
    <td>Longitude</td>

    <td>Latitude in E5</td>
    <td>Longitude in E5</td>
    <td>Change In Latitude</td>
    <td>Change In Longitude</td>
    <td>Encoded Latitude</td>
    <td>Encoded Longitude</td>

    <td>Encoded Point</td>
    </tr>

    <tr>
    <td>38.5</td>
    <td>-120.2</td>
    <td>3850000</td>

    <td>-12020000</td>
    <td>+3850000</td>
    <td>-12020000</td>
    <td><code>_p~iF</code></td>
    <td><code>~ps|U</code></td>
    <td><code>_p~iF~ps|U</code></td>

    </tr>

    <tr>
    <td>40.7</td>
    <td>-120.95</td>
    <td>4070000</td>
    <td>-12095000</td>

    <td>+220000</td>
    <td>-75000</td>
    <td><code>_ulL</code></td>
    <td><code>nnqC</code></td>
    <td><code>_ulLnnqC</code></td>
    </tr>

    <tr>
    <td>43.252</td>
    <td>-126.453</td>
    <td>4325200</td>
    <td>-12645300</td>
    <td>+255200</td>

    <td>-550300</td>
    <td><code>_mqN</code></td>
    <td><code>vxq`@</code></td>
    <td><code>_mqNvxq`@</code></td>
    </tr>
    </table>

    <br/>

    <p>Encoded polyline: <code>_p~iF~ps|U_ulLnnqC_mqNvxq`@</code></p>

  </div>

<h2>Encoding Levels</h2>

<p>An encoded polyline also stores information specifying the precision when 
drawing the polyline. This information allows the map to ignore drawing 
segments at zoom levels where that precision is not necessary. Each point in 
an encoded polyline stores this information in a <code>levels</code> string 
which is also encoded alongside the encoded points.</p>

<p>Note: this encoded "level" does not correspond directly to a zoom level, 
though they are related. More accurately, the <code>numLevels</code> parameter 
divides up the existing zoom levels (currently 18) into groups of zoom levels. 
For example, given a <code>numLevels</code> value of 4, the zoom levels are 
grouped together into the following levels:</p>

<table class="grid">
    <tr class="header">
    <td>Encoded Polyline Level</td>
    <td>Zoom Levels</td>
    </tr>
    <tr>
    <td>Level 0</td>
    <td>Zoom levels 0-5</td>
    </tr>
    <tr>
    <td>Level 1</td>
    <td>Zoom levels 6-10</td>
    </tr>
    <tr>
    <td>Level 2</td>
    <td>Zoom levels 11-14</td>
    </tr>
    <tr>
    <td>Level 3</td>
    <td>Zoom levels 15-18</td>
    </tr>
</table>

<p>An encoded level value of 3 in this case would ensure that a point appears in all 
zoom level, while a level of 0 will ignore points specified beyond zoom level 5. The 
endpoints of a polyline should often be set to the largest encoded level, to ensure 
that the endpoints will appear in all zoom levels and the line is drawn correctly.</p>

<p>For optimization, the <code>zoomFactor</code> parameter should reflect the 
approximate magnification between the different zoom level groups specified in 
<code>numLevels</code>. For example, given a doubling for each zoom level and 
about 4 zoom levels in each group, this value should be set to 16.</p>

<p>These level values are encoded in base64 as unsigned integers. Note that because 
level values are generally small, they shouldn't cross a 5-bit boundary; this 
results in level encodings being very simple: the value is simply added to 63. 
However, the encoding process below assumes you convert to a binary value and 
back again, and your code should perform this conversion in case the value of 
levels changes in an API revision.</p>

<p>The steps for encoding an unsigned value are specified below:</p>

<ol>
<li>Take the initial unsigned value:<br/>
<b>174</b>
</li>
<li>Convert the decimal value to a binary value:<br/>
<b>10101110</b>
</li>
<li>Break the binary value out into 5-bit chunks (starting from the right hand side):<br/>
<b>101 01110</b>
</li>
<li>Place the 5-bit chunks into reverse order:<br/>
<b>01110 101</b>
</li>
<li>OR each value with 0x20 if another bit chunk follows:<br/>
<b>101110 00101</b>
</li>
<li>Convert each value to decimal:<br/>
<b>46 5</b>
</li>
<li>Add 63 to each value:<br/>
<b>109 68</b>
</li>
<li>Convert each value to its ASCII equivalent:<br/>
<b>mD</b>
</li>
</ol>
</div>
        <!-- end body text -->


   
      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
    &copy;2010 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>

